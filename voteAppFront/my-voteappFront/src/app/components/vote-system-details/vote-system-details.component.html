<div class="vote-system-details-container">
    <div class="navigation-header">
      <button class="back-btn" (click)="goBack()">
        <i class="fas fa-arrow-left"></i> Înapoi la lista de sisteme
      </button>
    </div>
  
    <div class="loading-container" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Se încarcă detaliile sistemului de vot...</p>
    </div>
    
    <div class="error-message" *ngIf="errorMessage && !isLoading">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ errorMessage }}</p>
    </div>
    
    <div class="vote-system-content" *ngIf="voteSystem && !isLoading">
      <div class="system-header">
        <h1>{{ voteSystem.name }}</h1>
        
        <div class="status-badge" [ngClass]="getStatusClass()">
          <span>{{ getStatusText() }}</span>
        </div>
      </div>
      
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width]="getVoteProgress() + '%'"></div>
        </div>
        <div class="progress-status">
          {{ getVoteStatusText() }}
        </div>
      </div>

      
      <div class="system-tabs">
        <div class="tab" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
          <i class="fas fa-info-circle"></i> Prezentare
        </div>
        <div class="tab" [class.active]="activeTab === 'results'" (click)="setActiveTab('results')">
          <i class="fas fa-chart-pie"></i> Rezultate
        </div>
        <div class="tab" [class.active]="activeTab === 'share'" (click)="setActiveTab('share')">
          <i class="fas fa-share-alt"></i> Distribuie
        </div>
        <div class="tab" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
          <i class="fas fa-cog"></i> Setări
        </div>
      </div>

      <div class="tab-content" *ngIf="activeTab === 'overview'">
        <div class="overview-container">
          <div class="system-description">
            <h3>Descriere</h3>
            <p>{{ voteSystem.description }}</p>
          </div>
          
          <div class="system-details">
            <h3>Detalii</h3>
            
            <div class="detail-item">
              <span class="detail-label">Creat la:</span>
              <span class="detail-value">{{ formatDate(voteSystem.created_at) }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">Data începerii:</span>
              <span class="detail-value">{{ formatDate(voteSystem.start_date) }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">Data încheierii:</span>
              <span class="detail-value">{{ formatDate(voteSystem.end_date) }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">Total voturi:</span>
              <span class="detail-value">{{ totalVotes }}</span>
            </div>
          </div>
          
          <div class="voting-section" *ngIf="isVoteActive() && !voteSubmitted">
            <h3>Votează</h3>
            
            <form [formGroup]="voteForm" (ngSubmit)="submitVote()">
              <div class="vote-error" *ngIf="voteError">
                <i class="fas fa-exclamation-triangle"></i>
                {{ voteError }}
              </div>
              
              <div class="vote-options">
                <div class="option-item" *ngFor="let option of voteSystem.options">
                  <input type="radio" 
                        [id]="'option-' + option.id" 
                        formControlName="selectedOption" 
                        [value]="option.id">
                  <label [for]="'option-' + option.id">
                    <span class="option-title">{{ option.title }}</span>
                  </label>
                </div>
              </div>
              
              <button type="submit" class="btn-primary submit-vote-btn" [disabled]="voteForm.invalid || isSubmittingVote">
                <span *ngIf="!isSubmittingVote">Trimite vot</span>
                <span *ngIf="isSubmittingVote">
                  <i class="fas fa-spinner fa-spin"></i> Se procesează...
                </span>
              </button>
            </form>
          </div>

          <div class="vote-success" *ngIf="voteSubmitted">
            <div class="success-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3>Votul tău a fost înregistrat cu succes!</h3>
            <p>Îți mulțumim pentru participare.</p>
          </div>
        </div>
      </div>
      
      <div class="tab-content" *ngIf="activeTab === 'results'">
        <div class="results-container">
          <h3>Rezultate vot</h3>
          
          <div class="total-votes-info">
            <p>Total voturi înregistrate: <strong>{{ totalVotes }}</strong></p>
          </div>
          
          <div *ngIf="totalVotes === 0" class="no-votes-message">
            <i class="fas fa-info-circle"></i>
            <p>Nu există încă voturi înregistrate pentru acest sistem.</p>
          </div>
          
          <div *ngIf="totalVotes > 0" class="results-charts">
            <div class="chart-container">
              <h4>Distribuția voturilor (diagrama circulară)</h4>
              <div class="chart-wrapper">
                <canvas #pieChartCanvas></canvas>
              </div>
            </div>
            
            <div class="chart-container">
              <h4>Clasament opțiuni (diagrama bară)</h4>
              <div class="chart-wrapper">
                <canvas #barChartCanvas></canvas>
              </div>
            </div>
          </div>
          
          <div class="results-table" *ngIf="totalVotes > 0">
            <h4>Detalii voturi</h4>
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Opțiune</th>
                  <th>Voturi</th>
                  <th>Procent</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let option of resultsData; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ option.title }}</td>
                  <td>{{ option.votes_count }}</td>
                  <td>{{ option.percentage }}%</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="results-note">
            <p><i class="fas fa-sync-alt"></i> Rezultatele se actualizează automat la fiecare 10 secunde</p>
          </div>
        </div>
      </div>
      
      <div class="tab-content" *ngIf="activeTab === 'share'">
        <div class="share-container">
          <h3>Distribuie sistem de vot</h3>
          
          <div class="share-methods">
            <div class="share-item">
              <h4>Link direct</h4>
              <div class="share-input-group">
                <input type="text" [value]="shareLinks.directLink" readonly>
                <button class="btn-copy" (click)="copyToClipboard(shareLinks.directLink)">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            
<div class="share-item">
  <h4>Cod QR</h4>
  <div class="qr-image">
    <img [src]="shareLinks.qrCodeUrl" alt="QR Code">
    <div class="localhost-warning" *ngIf="isLocalhost">
      <i class="fas fa-exclamation-triangle"></i>
      <p>Acest cod QR funcționează doar în mediul de producție. În dezvoltare (localhost), scanarea va rezulta într-o eroare.</p>
    </div>
  </div>
</div>
            
            <div class="share-social">
              <h4>Distribuie pe rețele sociale</h4>
              <div class="social-buttons">
                <a [href]="getShareFacebookLink()" 
                   target="_blank" class="social-btn facebook">
                  <i class="fab fa-facebook-f"></i>
                </a>
                
                <a [href]="getShareTwitterLink()" 
                   target="_blank" class="social-btn twitter">
                  <i class="fab fa-twitter"></i>
                </a>
                
                <a [href]="getShareWhatsAppLink()" 
                   target="_blank" class="social-btn whatsapp">
                  <i class="fab fa-whatsapp"></i>
                </a>
                
                <a [href]="getShareEmailLink()" 
                   class="social-btn email">
                  <i class="fas fa-envelope"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
<div class="tab-content" *ngIf="activeTab === 'settings'">
  <div class="settings-container">
    <h3>Setări sistem de vot</h3>
    
    <div class="success-message" *ngIf="editSuccess">
      <i class="fas fa-check-circle"></i>
      {{ editSuccess }}
    </div>
    
    <div class="error-message" *ngIf="editError">
      <i class="fas fa-exclamation-triangle"></i>
      {{ editError }}
    </div>
    
    <div class="settings-actions" *ngIf="!isEditing && !deleteConfirmationOpen">
      <button 
        class="btn-edit" 
        [class.disabled]="!canEdit()" 
        [disabled]="!canEdit()"
        (click)="openEditForm()" 
        [title]="getEditButtonTooltip()">
        <i class="fas fa-edit"></i> Editează sistem
      </button>
      
      <button class="btn-delete" (click)="openDeleteConfirmation()">
        <i class="fas fa-trash"></i> Șterge sistem
      </button>
    </div>
    
    <div class="edit-form-container" *ngIf="isEditing">
      <form [formGroup]="editForm" (ngSubmit)="submitEditForm()">
        <h4>Editare sistem de vot</h4>
        
        <div class="form-group">
          <label for="name">Numele sistemului de vot<span class="required">*</span></label>
          <input 
            type="text" 
            id="name" 
            formControlName="name" 
            [class.invalid]="hasError('name')"
            placeholder="Ex: Alegerea președintelui asociației de locatari">
          <div class="error-text" *ngIf="hasError('name')">
            {{ getErrorMessage('name') }}
          </div>
        </div>
        
        <div class="form-group">
          <label for="description">Descriere<span class="required">*</span></label>
          <textarea 
            id="description" 
            formControlName="description" 
            [class.invalid]="hasError('description')"
            placeholder="Descrieți scopul acestui vot și orice alte informații relevante pentru votanți."
            rows="5"></textarea>
          <div class="error-text" *ngIf="hasError('description')">
            {{ getErrorMessage('description') }}
          </div>
        </div>
        
        <div class="form-group">
          <label for="category">Categorie<span class="required">*</span></label>
          <select 
            id="category" 
            formControlName="category"
            [class.invalid]="hasError('category')">
            <option value="">Selectați o categorie</option>
            <option value="political">Vot politic/electoral</option>
            <option value="organizational">Vot organizațional</option>
            <option value="community">Vot comunitar</option>
            <option value="survey">Sondaj/Chestionar</option>
            <option value="decision">Luare de decizii</option>
            <option value="other">Altele</option>
          </select>
        </div>
        
        <h4>Programare</h4>
        
        <div class="form-row">
          <div class="form-group half-width">
            <label for="start_date">Data începerii<span class="required">*</span></label>
            <input 
              type="date" 
              id="start_date" 
              formControlName="start_date"
              [class.invalid]="hasError('start_date')">
          </div>
          
          <div class="form-group half-width">
            <label for="start_time">Ora începerii<span class="required">*</span></label>
            <input 
              type="time" 
              id="start_time" 
              formControlName="start_time"
              [class.invalid]="hasError('start_time')">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group half-width">
            <label for="end_date">Data încheierii<span class="required">*</span></label>
            <input 
              type="date" 
              id="end_date" 
              formControlName="end_date"
              [class.invalid]="hasError('end_date')">
          </div>
          
          <div class="form-group half-width">
            <label for="end_time">Ora încheierii<span class="required">*</span></label>
            <input 
              type="time" 
              id="end_time" 
              formControlName="end_time"
              [class.invalid]="hasError('end_time')">
          </div>
        </div>
        
        <h4>Opțiuni de vot</h4>
        
        <div formArrayName="options">
          <div *ngFor="let option of optionsArray.controls; let i = index" class="option-item" [formGroupName]="i">
            <div class="option-header">
              <h4>Opțiunea {{ i + 1 }}</h4>
              <button 
                type="button" 
                class="btn-remove-option" 
                (click)="removeOption(i)" 
                *ngIf="optionsArray.length > 2">
                <i class="fas fa-times"></i>
              </button>
            </div>
            
            <div class="form-group">
              <label [for]="'option-title-' + i">Titlu<span class="required">*</span></label>
              <input 
                type="text" 
                [id]="'option-title-' + i" 
                formControlName="title"
                [class.invalid]="hasOptionError(i, 'title')"
                placeholder="Numele opțiunii de vot">
              <div class="error-text" *ngIf="hasOptionError(i, 'title')">
                {{ getOptionErrorMessage(i, 'title') }}
              </div>
            </div>
            
            <div class="form-group">
              <label [for]="'option-description-' + i">Descriere</label>
              <textarea 
                [id]="'option-description-' + i" 
                formControlName="description"
                placeholder="Descriere opțională pentru această opțiune"
                rows="2"></textarea>
            </div>
            
            <div class="form-group">
              <label [for]="'option-image-' + i">URL imagine</label>
              <input 
                type="text" 
                [id]="'option-image-' + i" 
                formControlName="image_url"
                placeholder="Link către imaginea reprezentativă (opțional)">
            </div>
          </div>
        </div>
        
        <div class="option-actions">
          <button type="button" class="btn-add-option" (click)="addOption()">
            <i class="fas fa-plus"></i> Adaugă opțiune
          </button>
        </div>
        
        <h4>Gestionare email-uri votanți</h4>
        
        <div class="form-group">
          <label for="voter-emails">Email-uri votanți<span class="required">*</span></label>
          <div class="email-info-text">
            <i class="fas fa-info-circle"></i>
            <span>Introduceți câte un email pe fiecare linie. Email-urile adăugate sau modificate vor primi token-uri de vot la salvare.</span>
          </div>
          <textarea 
            id="voter-emails" 
            formControlName="voter_emails" 
            [class.invalid]="hasError('voter_emails')"
            placeholder="exemplu@domeniu.ro
    alt.exemplu@domeniu.com
    etc..."
            rows="6"></textarea>
          <div class="error-text" *ngIf="hasError('voter_emails')">
            {{ getErrorMessage('voter_emails') }}
          </div>
          
          <div class="email-count" *ngIf="getEmailCount() > 0">
            <i class="fas fa-users"></i> {{ getEmailCount() }} adrese email
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelEdit()">
            <i class="fas fa-times"></i> Anulează
          </button>
          <button type="submit" class="btn-primary" [disabled]="isEditSubmitting">
            <span *ngIf="!isEditSubmitting">
              <i class="fas fa-save"></i> Salvează modificările
            </span>
            <span *ngIf="isEditSubmitting">
              <i class="fas fa-spinner fa-spin"></i> Se salvează...
            </span>
          </button>
        </div>
      </form>
    </div>

    <div class="delete-confirmation" *ngIf="deleteConfirmationOpen">
      <div class="confirmation-header">
        <i class="fas fa-exclamation-triangle"></i>
        <h4>Confirmați ștergerea</h4>
      </div>
      
      <p class="confirmation-message">
        Sunteți sigur că doriți să ștergeți sistemul de vot "<strong>{{ voteSystem?.name }}</strong>"?
      </p>
      
      <p class="warning-text">
        Această acțiune este <strong>ireversibilă</strong> și va șterge toate datele asociate, inclusiv voturile înregistrate.
      </p>
      
      <div class="error-message" *ngIf="deleteError">
        <i class="fas fa-exclamation-triangle"></i>
        {{ deleteError }}
      </div>
      
      <div class="confirmation-actions">
        <button type="button" class="btn-secondary" (click)="cancelDelete()">
          <i class="fas fa-times"></i> Anulează
        </button>
        <button type="button" class="btn-danger" [disabled]="isDeleting" (click)="deleteVoteSystem()">
          <span *ngIf="!isDeleting">
            <i class="fas fa-trash"></i> Da, șterge sistemul
          </span>
          <span *ngIf="isDeleting">
            <i class="fas fa-spinner fa-spin"></i> Se șterge...
          </span>
        </button>
      </div>
    </div>
    
    <div class="settings-info" *ngIf="!isEditing && !deleteConfirmationOpen">
      <div class="info-box">
        <div class="info-icon">
          <i class="fas fa-info-circle"></i>
        </div>
        <div class="info-content">
          <h4>Informații despre modificări</h4>
          <ul>
            <li>Puteți edita sistemul de vot doar dacă este în starea "În așteptare".</li>
            <li>Odată ce votul a început sau s-a încheiat, nu mai puteți modifica setările.</li>
            <li>Ștergerea sistemului de vot este permanentă și nu poate fi anulată.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>