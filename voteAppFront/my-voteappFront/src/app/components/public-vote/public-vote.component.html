<div class="public-vote-container">
  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Se încarcă sistemul de vot...</p>
  </div>
  
  <!-- Error message -->
  <div class="error-message" *ngIf="errorMessage && !isLoading">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
  </div>
  
  <!-- Vote system details -->
  <div class="vote-system-content" *ngIf="voteSystem && !isLoading">
    <div class="system-header">
      <h1>{{ voteSystem.name }}</h1>
      
      <!-- Status badge -->
      <div class="status-badge" [class.status-active]="isVoteActive()">
        <span *ngIf="isVoteActive()">Activ</span>
        <span *ngIf="!isVoteActive()">Inactiv</span>
      </div>
    </div>
    
    <div class="progress-bar-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width]="getVoteProgress() + '%'"></div>
      </div>
      <div class="progress-status">
        {{ getVoteStatusText() }}
      </div>
    </div>
    
    <div class="system-description">
      <p>{{ voteSystem.description }}</p>
    </div>
    
    <!-- Verificare email token dacă este necesar -->
    <div class="email-verification-section" *ngIf="requiresEmailVerification && !emailVerified && isVoteActive() && !voteSubmitted">
      <div class="token-verification-container">
        <h3>Verificare cod de acces</h3>
        
        <div class="verification-instructions">
          <p>Pentru a putea vota în acest sistem, trebuie să introduci adresa de email și codul de acces primit.</p>
          <p>Codul este valabil 3 minute de la primire și poate fi folosit o singură dată.</p>
        </div>
        
        <form [formGroup]="tokenForm" (ngSubmit)="verifyToken()">
          <div class="error-message" *ngIf="tokenError">
            <i class="fas fa-exclamation-triangle"></i>
            {{ tokenError }}
          </div>
          
          <div class="form-group">
            <label for="email">Adresa de email<span class="required">*</span></label>
            <input 
              type="email" 
              id="email" 
              formControlName="email" 
              placeholder="Introduceți adresa de email"
              [class.invalid]="tokenForm.get('email')?.invalid && (tokenForm.get('email')?.dirty || tokenForm.get('email')?.touched)">
            <div class="error-text" *ngIf="tokenForm.get('email')?.errors?.['required'] && (tokenForm.get('email')?.dirty || tokenForm.get('email')?.touched)">
              Adresa de email este obligatorie.
            </div>
            <div class="error-text" *ngIf="tokenForm.get('email')?.errors?.['email'] && (tokenForm.get('email')?.dirty || tokenForm.get('email')?.touched)">
              Introduceți o adresă de email validă.
            </div>
          </div>
          
          <div class="form-group">
            <label for="token">Cod de acces<span class="required">*</span></label>
            <input 
              type="text" 
              id="token" 
              formControlName="token" 
              placeholder="Introduceți codul de 6 caractere"
              [class.invalid]="tokenForm.get('token')?.invalid && (tokenForm.get('token')?.dirty || tokenForm.get('token')?.touched)"
              maxlength="6"
              autocomplete="off">
            <div class="error-text" *ngIf="tokenForm.get('token')?.errors?.['required'] && (tokenForm.get('token')?.dirty || tokenForm.get('token')?.touched)">
              Codul de acces este obligatoriu.
            </div>
            <div class="error-text" *ngIf="(tokenForm.get('token')?.errors?.['minlength'] || tokenForm.get('token')?.errors?.['maxlength']) && (tokenForm.get('token')?.dirty || tokenForm.get('token')?.touched)">
              Codul trebuie să aibă exact 6 caractere.
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="tokenForm.invalid || isVerifying">
              <span *ngIf="!isVerifying">Verifică</span>
              <span *ngIf="isVerifying">
                <i class="fas fa-spinner fa-spin"></i> Se verifică...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Mesaj pentru verificare prin email -->
    <div class="email-verification-notice" *ngIf="requiresEmailVerification && !emailVerified && !voteSubmitted && isVoteActive()">
      <p>Pentru a vota în acest sistem, trebuie să verifici adresa de email folosind codul primit.</p>
    </div>
    
    <!-- Voting Form -->
    <div class="voting-section" *ngIf="isVoteActive() && !voteSubmitted && (!requiresEmailVerification || emailVerified)">
      <h3>Votează</h3>
      
      <form [formGroup]="voteForm" (ngSubmit)="submitVote()">
        <div class="vote-error" *ngIf="voteError">
          <i class="fas fa-exclamation-triangle"></i>
          {{ voteError }}
        </div>
        
        <div class="vote-options">
          <div class="option-item" *ngFor="let option of voteSystem.options">
            <input type="radio" 
                  [id]="'option-' + option.id" 
                  formControlName="selectedOption" 
                  [value]="option.id">
            <label [for]="'option-' + option.id">
              <div class="option-content">
                <span class="option-title">{{ option.title }}</span>
                <p class="option-description" *ngIf="option.description">{{ option.description }}</p>
                <img *ngIf="option.image_url" [src]="option.image_url" [alt]="option.title" class="option-image">
              </div>
            </label>
          </div>
        </div>
        
        <button type="submit" class="submit-vote-btn" [disabled]="voteForm.invalid || isSubmittingVote">
          <span *ngIf="!isSubmittingVote">Trimite vot</span>
          <span *ngIf="isSubmittingVote">
            <i class="fas fa-spinner fa-spin"></i> Se procesează...
          </span>
        </button>
      </form>
    </div>
    
    <!-- Vote Submitted Message -->
    <div class="vote-success" *ngIf="voteSubmitted">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3>Votul tău a fost înregistrat cu succes!</h3>
      <p>Îți mulțumim pentru participare.</p>
    </div>
    
    <!-- Results section -->
    <div class="results-container" *ngIf="showResults">
      <h3>Rezultate vot</h3>
      
      <div class="results-chart-container">
        <div echarts [options]="chartOptions" class="results-chart"></div>
      </div>
      
      <div class="results-table">
        <table>
          <thead>
            <tr>
              <th>Opțiune</th>
              <th>Voturi</th>
              <th>Procent</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let option of voteSystem.options">
              <td>{{ option.title }}</td>
              <td>{{ option.votes_count }}</td>
              <td>{{ voteSystem.total_votes > 0 ? (option.votes_count / voteSystem.total_votes * 100).toFixed(2) : '0' }}%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Footer cu informații despre sistemul de vot -->
    <div class="system-footer">
      <div class="footer-info">
        <span>Creat de: {{ voteSystem.creator_name || 'Administratorul sistemului' }}</span>
        <span>Categoria: {{ voteSystem.category }}</span>
      </div>
    </div>
  </div>
</div>