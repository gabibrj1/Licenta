<!-- Container principal -->
<div class="map-container" [attr.data-map-location]="mapLocation">
  <!-- Titlu harta - minimalist -->
  <div class="map-title">
    <h1>{{ mapLocation === 'romania' ? 'Hartă județe' : 'Hartă internațională' }}</h1>
  </div>
  
  <!-- Loader -->
  <div class="loader-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Se încarcă harta...</p>
  </div>

  <!-- Continut principal - structură optimizată -->
  <div class="map-content" *ngIf="!isLoading">
    <!-- Header statistici și filtre într-un rând -->
    <div class="top-controls">
      <!-- Bloc statistici -->
      <div class="votanti-stats">
        <div class="stats-title">Votanți</div>
        <div class="stats-numbers">
          <span class="count">{{totalVoters}}</span>
          <span class="percentage">| {{totalPercentage}} %</span>
        </div>
      </div>
      
      <!-- Filtre organizate pe două rânduri -->
      <div class="filters-container">
        <div class="filters-row">
          <!-- NIVEL HARTĂ - doar pentru România -->
          <div class="filter-group" *ngIf="mapLocation === 'romania'">
            <span class="category-label">NIVEL HARTĂ</span>
            <div class="buttons-inline">
              <button class="filter-button" [class.active]="mapLevel === 'judete'" (click)="setMapLevel('judete')">Județe</button>
              <button class="filter-button" [class.active]="mapLevel === 'uaturi'" (click)="setMapLevel('uaturi')">UAT-uri</button>
            </div>
          </div>

          <!-- County selector - doar pentru România -->
          <div class="county-selector" *ngIf="mapLevel === 'uaturi' && mapLocation === 'romania'">
            <label for="county-select">Selectează județul:</label>
            <select #countySelect id="county-select" (change)="loadCountyUATMap(countySelect.value)" [value]="selectedCounty">
              <option value="">Alege județul</option>
              <option *ngFor="let county of countyOptions" [value]="county.code" [selected]="county.code === selectedCounty">
                {{ county.name }}
              </option>
            </select>
          </div>
          
          <!-- Adaugă o informație despre județul selectat când vizualizarea UAT este activă -->
          <div class="selected-county-info" *ngIf="isUATView && selectedCounty && mapLocation === 'romania'">
            <h3>UAT-uri {{ getCountyName(selectedCounty) }}</h3>
          </div>
          
          <div class="filter-group">
            <span class="category-label">CÂMP EVIDENȚIERE</span>
            <div class="buttons-inline">
              <!-- Pentru România - toate opțiunile -->
              <ng-container *ngIf="mapLocation === 'romania'">
                <button class="filter-button" [class.active]="highlightField === 'prezenta'" (click)="setHighlightField('prezenta')">
                  <span class="btn-icon">🔍</span> Prezență la vot
                </button>
                <button class="filter-button" [class.active]="highlightField === 'votanti'" (click)="setHighlightField('votanti')">
                  <span class="btn-icon">👤</span> Votanți
                </button>
                <button class="filter-button" [class.active]="highlightField === 'sectii'" (click)="setHighlightField('sectii')">
                  <span class="btn-icon">📍</span> Secții de votare
                </button>
              </ng-container>
              
              <!-- Pentru Străinătate, afișează doar Votanți și Secții -->
              <ng-container *ngIf="mapLocation === 'strainatate'">
                <button class="filter-button" [class.active]="highlightField === 'votanti'" (click)="setHighlightField('votanti')">
                  <span class="btn-icon">👤</span> Votanți
                </button>
                <button class="filter-button" [class.active]="highlightField === 'sectii'" (click)="setHighlightField('sectii')">
                  <span class="btn-icon">📍</span> Secții de votare
                </button>
              </ng-container>
            </div>
          </div>
        </div>
        
        <div class="filters-row">
          <!-- RELATIV LA - doar pentru România -->
          <div class="filter-group" *ngIf="highlightField === 'prezenta' && mapLocation === 'romania'">
            <span class="category-label">RELATIV LA:</span>
            <div class="buttons-inline">
              <button class="filter-button" [class.active]="relativeTo === 'maxim'" (click)="setRelativeTo('maxim')">Maxim</button>
              <button class="filter-button" [class.active]="relativeTo === 'total'" (click)="setRelativeTo('total')">100%</button>
            </div>
            <!-- Butonul Înapoi poziționat sub Maxim când prezența la vot este activată -->
            <div class="back-button-wrapper" *ngIf="isUATView">
              <button class="back-button" (click)="backToCountyView()">← Înapoi</button>
            </div>
          </div>
          
          <!-- Butonul Înapoi pentru celelalte cazuri (când nu este activată prezența la vot) -->
          <div class="back-button-container" *ngIf="isUATView && highlightField !== 'prezenta' && mapLocation === 'romania'">
            <button class="back-button" (click)="backToCountyView()">← Înapoi</button>
          </div>
          
          <!-- Container actiuni - poziționat în linie cu celelalte filtre -->
          <div class="action-container">
            <button class="download-button" (click)="downloadCSV()">
              <span class="icon-download">⬇️</span>
              Descarcă CSV
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Vizualizare harta - container optimizat -->
    <div class="map-visualization">
      <!-- Container harta - diferit pentru România vs. Străinătate -->
      <ng-container *ngIf="mapLocation === 'romania'">
        <div class="svg-container" #mapContainer>
          <!-- Harta se va genera aici pentru România -->
        </div>
      </ng-container>
      
      <!-- Container special pentru harta mondială -->
      <ng-container *ngIf="mapLocation === 'strainatate'">
        <div class="svg-container world-map-container" #mapContainer>
          <!-- Harta mondială se va genera aici -->
        </div>
        
        <!-- Controale de zoom opționale pentru harta mondială -->
        <div class="zoom-controls">
          <button (click)="zoomIn()">+</button>
          <button (click)="zoomOut()">-</button>
        </div>
      </ng-container>

      <!-- Tooltip judet/tara -->
      <div class="county-tooltip" 
          *ngIf="hoveredCounty" 
          [style.left.px]="hoverPosition.x"
          [style.top.px]="hoverPosition.y"
          [style.display]="hoveredCounty ? 'block' : 'none'">
        <div class="tooltip-header">{{hoveredCounty.name}}</div>
        <div class="tooltip-data-grid">
          <!-- Pentru România -->
          <ng-container *ngIf="mapLocation === 'romania'">
            <div class="tooltip-row">
              <span class="label">Înscriși pe liste permanente</span>
              <span class="value">{{ hoveredCounty.registeredVoters | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Secții de votare</span>
              <span class="value">{{ hoveredCounty.pollingStationCount | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Votanți pe liste permanente</span>
              <span class="value">{{ hoveredCounty.permanentListVoters | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Votanți pe liste suplimentare</span>
              <span class="value">{{ hoveredCounty.supplementaryListVoters | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Votanți cu urnă mobilă</span>
              <span class="value">{{ hoveredCounty.mobileUrnsVoters | number }}</span>
            </div>
            <div class="tooltip-row total-row">
              <span class="label">Total votanți</span>
              <span class="value">{{ hoveredCounty.totalVoters | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Prezență</span>
              <span class="value">{{ hoveredCounty.turnoutPercentage }}%</span>
            </div>
          </ng-container>
          
          <!-- Pentru Străinătate -->
          <ng-container *ngIf="mapLocation === 'strainatate'">
            <div class="tooltip-row">
              <span class="label">Secții de votare</span>
              <span class="value">{{ hoveredCounty.pollingStationCount | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Votanți pe liste permanente</span>
              <span class="value">{{ hoveredCounty.permanentListVoters | number }}</span>
            </div>
            <div class="tooltip-row">
              <span class="label">Votanți prin corespondență</span>
              <span class="value">{{ hoveredCounty.correspondenceVoters | number }}</span>
            </div>
            <div class="tooltip-row total-row">
              <span class="label">Total votanți</span>
              <span class="value">{{ hoveredCounty.totalVoters | number }}</span>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Legenda -->
      <div class="legend-container">
        <div class="max-label">Max <span>100</span></div>
        <div class="slider-container">
          <div class="gradient-bar"></div>
          <input 
            type="range" 
            class="percentage-slider" 
            min="0" 
            max="100" 
            step="0.1" 
            [(ngModel)]="filterPercentage" 
            (input)="onFilterChange()">
        </div>
        <div class="min-label">Min <span>0</span></div>
        <div class="filter-value">
          <span>Filtrare: {{filterPercentage | number:'1.1-1'}}%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer optimizat -->
  <div class="map-footer">
    <div class="footer-items">
      <div class="footer-item footer-text" (click)="navigateToHome()" style="cursor: pointer;">VoteAI</div>
      <div class="footer-item footer-logo">
        <img src="assets/icons/Logo-UT-ALB-RO.png" alt="Universitatea Transilvania din Brașov">
      </div>
      <div class="footer-item footer-logo">
        <img src="assets/icons/Logo-UT-IESC-ALB-RO.png" alt="IESC-CALC">
      </div>
    </div>
  </div>
</div>