<div class="map-container">
  <!-- Loader -->
  <div class="loader-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Se încarcă harta...</p>
  </div>

  <!-- Main Content -->
  <div class="map-content" *ngIf="!isLoading">
    <!-- Votanți Header -->
    <div class="votanti-header">
      <h2>Votanți</h2>
      <div class="stats-numbers">
        <span class="count">{{totalVoters}}</span>
        <span class="percentage">| {{totalPercentage}} %</span>
      </div>
    </div>

    <!-- Filter Controls -->
    <div class="filter-controls">
      <!-- NIVEL HARTĂ -->
      <div class="control-section">
        <h5 class="control-label">NIVEL HARTĂ</h5>
        <div class="buttons-group">
          <button class="filter-button" [class.active]="mapLevel === 'judete'" (click)="setMapLevel('judete')">Județe</button>
          <button class="filter-button" [class.active]="mapLevel === 'uaturi'" (click)="setMapLevel('uaturi')">UAT-uri</button>
        </div>
      </div>

      <!-- CÂMP EVIDENȚIERE -->
      <div class="control-section">
        <h5 class="control-label">CÂMP EVIDENȚIERE</h5>
        <div class="buttons-group">
          <button class="filter-button" [class.active]="highlightField === 'prezenta'" (click)="setHighlightField('prezenta')">Prezență la vot</button>
          <button class="filter-button" [class.active]="highlightField === 'votanti'" (click)="setHighlightField('votanti')">Votanți</button>
          <button class="filter-button" [class.active]="highlightField === 'sectii'" (click)="setHighlightField('sectii')">Secții de votare</button>
        </div>
      </div>

      <!-- RELATIV LA: -->
      <div class="control-section">
        <h5 class="control-label">RELATIV LA:</h5>
        <div class="buttons-group">
          <button class="filter-button" [class.active]="relativeTo === 'maxim'" (click)="setRelativeTo('maxim')">Maxim</button>
          <button class="filter-button" [class.active]="relativeTo === 'total'" (click)="setRelativeTo('total')">100%</button>
        </div>
      </div>
    </div>

    <!-- Map Visualization -->
    <div class="map-visualization">
      <!-- Romania Map Container -->
      <div class="svg-container" #mapContainer>
        <!-- Map will be generated here -->
      </div>

      <!-- County Tooltip -->
<!-- County Tooltip -->
<div class="county-tooltip" *ngIf="hoveredCounty" [style.left.px]="hoverPosition.x" [style.top.px]="hoverPosition.y">
  <strong>{{ hoveredCounty.name }}</strong>
  <div class="tooltip-data-grid">
    <div class="tooltip-row">
      <span class="label">Înscriși pe liste permanente</span>
      <span class="value">{{ hoveredCounty.registeredVoters | number }}</span>
    </div>
    <div class="tooltip-row">
      <span class="label">Secții de votare</span>
      <span class="value">{{ hoveredCounty.pollingStationCount | number }}</span>
    </div>
    <div class="tooltip-row">
      <span class="label">Votanți pe liste permanente</span>
      <span class="value">{{ hoveredCounty.permanentListVoters | number }}</span>
    </div>
    <div class="tooltip-row">
      <span class="label">Votanți pe liste suplimentare</span>
      <span class="value">{{ hoveredCounty.supplementaryListVoters | number }}</span>
    </div>
    <div class="tooltip-row">
      <span class="label">Votanți cu urnă mobilă</span>
      <span class="value">{{ hoveredCounty.mobileUrnsVoters | number }}</span>
    </div>
    <div class="tooltip-row total-row">
      <span class="label">Total votanți</span>
      <span class="value">{{ hoveredCounty.totalVoters | number }}</span>
    </div>
    <div class="tooltip-row">
      <span class="label">Prezență</span>
      <span class="value">{{ hoveredCounty.turnoutPercentage }}%</span>
    </div>
  </div>
</div>

      <!-- Map Legend -->
      <div class="legend-container">
        <div class="max-label">Max <span>{{maxValue}}</span></div>
        <div class="gradient-bar"></div>
        <div class="min-label">Min <span>{{minValue}}</span></div>
      </div>
    </div>

    <!-- Download CSV Button -->
    <div class="download-section">
      <button class="download-button" (click)="downloadCSV()">
        <span class="icon-download">⬇️</span>
        Descarcă CSV
      </button>
    </div>
  </div>
</div>